#!/bin/sh
# Forces the commit message to be in a certain format

set -eu

die () {
	printf '\033[31mError: %s\033[m\n' "${1:-"Script $0 exited with unknown error"}"
	exit 1
}

regex_titlecase_verb='^[A-Z][a-z]+ '
regex_titlecase_verb_sve='^[a-z][a-z]+ '
regex_imperative_verb='^[A-Z][a-z]+ed '

if [ "$(git config user.email)" = "sveselov@student.42berlin.de" ]; then # :PPPP
	grep -qE -e "$regex_titlecase_verb_sve" -- "$1" || \
		die "Commit message format is incorrect (must start with lowercase titlecase verb). Example: 'add feature' or 'update file'"
else
	grep -qE -e "$regex_titlecase_verb" -- "$1" || \
		die "Commit message format is incorrect (must start with uppercase titlecase verb). Example: 'Add feature' or 'Update file'"
fi

! grep -qE -e "$regex_imperative_verb" "$1" || \
	die "Commit message format is incorrect (use imperative verb form). Example: 'Add feature' or 'Update file'"
